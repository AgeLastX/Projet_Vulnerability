# Vulnerability Project

# FIRST

**git clone https://github.com/AgeLastX/Projet_Vulnerability.git** 

**cd Projet_Vulnerability/**  

# REQUIREMENTS 
## Parrot or Kali
If you are using a Parrot or Kali machine, the following requirements need to be met:

<sub>_(Installing crontab)_
_sudo apt-get install python3-crontab_

<sub>_(Installing Ansible)_
_sudo apt install ansible_

Please note that you don't need to install these manually. Just run the following command: 
  
**sudo sh install.sh** . This will handle the installation for you.
  
## Ubuntu / Debian 
  
If you are using a Ubuntu or Debian machine, the following requirements need to be met:
 
<sub>_(Installing Git)_
_sudo apt-get install git 
  
<sub>_(Installing crontab)_
_sudo apt-get install python3-crontab_

<sub>_(Installing Ansible)_
_sudo apt install ansible_
  
<sub>_(Installing Nmap)_
_sudo apt install nmap_

<sub>_(Installing Nikto)_
_sudo apt install nikto_

<sub>_(Installing Metasploit)_
_sudo apt install metasploit-framework_
  
Please note that you don't need to install these manually. Just run the following command: 
  
**sudo sh install_ubu_deb.sh** . This will handle the installation for you.
  
# START

**python3 start.py** to launch the script.

The script starts by asking the user if they want to send the test results via email. If the user confirms, they will be prompted to provide Microsoft login information (username, password) and the destination email address.

The script asks if the user wants to schedule a vulnerability scan task. If confirmed, the execution time will be requested, and the task will be scheduled using the CronTab library.

The script displays a menu to choose the target for vulnerability tests from the following options: Windows 7, Windows 10-11, Windows Server 2008-2012, Linux, or URLs.

For each OS or URL choice, the user can enter the corresponding IP addresses or URLs. This information is stored in a dictionary called "inventory".

Once the user finishes selecting targets, the script writes the inventory information to the "inventory.ini" file.

Next, the script executes the Ansible playbook "playbook.yaml" using the "ansible-playbook" command. It passes the Microsoft login information, destination email address, and confirmation through environment variables.

# ANSIBLE
The Ansible playbook performs the following tasks:

Uses the Nmap tool to perform port scanning on the target hosts.

Uses the Metasploit tool to perform penetration tests on the target hosts based on their groups (Windows 7, Windows Server 2008-2012, or Linux).

Uses the Nikto tool to perform vulnerability scans on the target URLs.

Cleans up result files and creates a "results.docx" file.

Generates a result report by adding the results of different tasks to the "results.docx" file.

Converts the "results.docx" file to PDF format using LibreOffice.

Sends the PDF file via email to the specified address if the confirmation is "yes".

The script ends after the execution of the Ansible playbook.
  
# PROCESS 

### **[Process Image](/img/resume_img.md)**
  
### [Process Video](https://vimeo.com/831697410)
  
# FILES
**_`config.ini`_**
  
The config.ini file is used to store configuration variables required by the program. It is used to store Microsoft e-mail login information (username, password), the destination e-mail address and confirmation that the vulnerability test result has been sent by e-mail.

Variables are defined under the [Variables] section and are used in the main script to send the result of the vulnerability test by e-mail, if the user has confirmed this option.

**_`design.sh`_**

The design.sh file is a shell script that generates the vulnerability report with a specific layout.

The design.sh script is used in the Ansible playbook to insert these pieces of information into the vulnerability report. These details provide information about the report's creation, including the date, time, and user who generated it.

**_`install.sh`_**  **_`install_ubu_deb.sh`_** 
  
The install.sh and install_ubu_deb.sh files contain shell commands to install the necessary dependencies for running the program.

**_`inventory.ini`_**

The inventory.ini file is used to define the inventory of target systems or hosts that will be used in the program. 

Each section in the file represents a group of hosts. In this case, there are five groups: Windows7, Windows1011, WindowsServer20082012, Linux, and Urls. The inventory file can be populated with the IP addresses or hostnames of the respective hosts belonging to each group.

**_`msploit_ws.sh`_** **_`msploit_win7.sh`_** **_`msploit_linux.sh`_**

The msploit_ws.sh , msploit_win7.sh and msploit_linux.sh files are a Bash scripts that performs multiple exploits using the Metasploit Framework
Each exploit is executed by running the msfconsole command with specific options and commands. The $1 variable represents the target host's IP address, which is passed as an argument to the script when executing it.

**_`nikto.sh`_**

The nikto.sh file is a Bash script that launches the Nikto tool for performing web server vulnerability scanning.
The script essentially launches Nikto and performs a vulnerability scan on the specified target host

**_`nmap.sh`_**
  
The nmap.sh file is a Bash script that performs a port scan using Nmap. Here's a breakdown of the script:
The script essentially launches an Nmap port scan on the specified target host and displays the lines that indicate open ports.

**_`playbook.yaml`_**

The playbook.yaml file describes an Ansible playbook for performing vulnerability testing on target hosts.

The tasks include:

"Nmap" task: Executes the "nmap.sh" script on each host using the shell command. The result is registered in the nmap_result variable.
  
"Metasploit" task: Executes different scripts (msploit_win7.sh, msploit_ws.sh, msploit_linux.sh) on hosts that belong to the specified groups. The results are registered in the msploit_result variable. The condition inventory_hostname in groups[item.group] checks if the current host belongs to the specified group.
  
"Nikto" task: Executes the "nikto.sh" script on hosts in the "Urls" group. The result is registered in the nikto_result variable.
  
"File-Cleaning" and "Prep Design" tasks: Manipulate a "results.docx" file on the first host in the "all" group. The "File-Cleaning" task copies an empty content to the file, and the "Prep Design" task executes the "design.sh" script and saves the result in the design_result variable.
  
"Result_File" task: Appends the results of the different executed tasks to the "results.docx" file on all hosts.
  
"docx into pdf" task: Converts the "results.docx" file to PDF format using LibreOffice on the last host in the "all" group.
  
"Send results by email" task: Sends the results via email using the Ansible mail module, attaching the generated PDF file. This task is executed only on the last host in the "all" group when the confirmation variable is set to 'yes'.
 
**_`results.docx`_**
  
"results.docx" is the test result in DOCX format.

**_`results.pdf`_**

"results.pdf" is the test result in PDF format.

**_`start.py`_**
  
The file start.py is a Python script that performs the following actions:

Imports necessary modules: os, subprocess, getpass, configparser, and CronTab from the crontab library.
  
Defines several functions to prompt the user for an IP address or URL, fill the inventory.ini file, display a graph, and write the inventory to a file.
  
Clears the contents of the inventory.ini file.

Asks the user whether they want to send the vulnerability test result by email and retrieves Microsoft login information if the answer is "yes".
  
Asks the user whether they want to schedule a vulnerability scan task and sets up the scheduling if the answer is "yes". The Microsoft credentials and other parameters are stored in a config.ini file.
  
Displays a menu to choose the target operating system (Windows 7, Windows 10-11, Windows Server 2008-2012, Linux, or URLs).
  
Asks the user to enter the corresponding IP addresses or URLs and adds them to the inventory based on the operating system choice.
  
Repeats until the user selects "Quit" or no operating system is selected.
  
Prints a message indicating that the vulnerability test is in progress.
  
Writes the inventory to the inventory.ini file.
  
Executes the ansible-playbook command with arguments, including the playbook.yaml file, inventory.ini, and environment variables for the Microsoft credentials and confirmation.
  
In summary, this script allows the user to select target operating systems, provide corresponding IP addresses or URLs, set up scheduling for a vulnerability scan task, send the results by email, and run an Ansible playbook based on the user's choices.
  
**_`tasks.py`_**
  
This script reads the configuration from config.ini and executes an Ansible playbook with the specified arguments, using the values retrieved from the configuration.

This is the file launched by the schedule task
  
  
  
  
  
  
  
  
